<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Builder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Merriweather:wght@300;400;700&family=Montserrat:wght@400;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-gray: #f3f4f6;
            --border-color: #e5e7eb;
            --a4-width: 210mm;
            --a4-height: 297mm;
            --text-dark: #1e293b;
            --text-muted: #64748b;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-gray);
            min-height: 100vh;
            margin: 0;
        }

        /* --- Layout --- */
        .app-container {
            display: flex;
            min-height: 100vh;
            flex-wrap: wrap;
        }

        .editor-panel {
            width: 45%;
            background: white;
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            z-index: 10;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
        }

        .preview-panel {
            width: 55%;
            background: #525659;
            display: flex;
            justify-content: center;
            padding: 40px 20px;
            min-height: 100vh; 
        }

        /* --- Editor Header & Toolbar --- */
        .editor-header {
            background: white;
            position: sticky;
            top: 0;
            z-index: 20;
            border-bottom: 1px solid var(--border-color);
        }

        .top-bar {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fff;
            border-bottom: 1px solid #eee;
        }

        .action-bar {
            padding: 15px 20px;
            background: #f8fafc;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
            flex-direction: column;
        }

        .download-btn {
            background-color: var(--text-dark);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 6px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: background 0.2s;
            width: 100%;
        }

        .download-btn:hover {
            background-color: #0f172a;
            color: white;
        }

        .editor-content {
            padding: 20px;
        }

        /* --- Accordion / Form --- */
        .section-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .section-header {
            padding: 15px;
            background: #f9fafb;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            color: #374151;
        }

        .section-header:hover {
            background: #f3f4f6;
        }

        .section-body {
            padding: 15px;
            display: none;
        }
        
        .section-body.open {
            display: block;
        }

        .form-label {
            font-size: 0.85rem;
            font-weight: 500;
            color: #374151;
        }

        .form-control, .form-select {
            font-size: 0.9rem;
            border-radius: 6px;
            border-color: #d1d5db;
        }

        .form-control:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .dynamic-item {
            border: 1px dashed var(--border-color);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 6px;
            position: relative;
            background: #fff;
        }

        .remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #ef4444;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 0.9rem;
        }

        /* --- Preview / A4 Styles --- */
        .resume-page {
            width: var(--a4-width);
            min-height: var(--a4-height);
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            margin: 0 auto;
            position: relative;
            box-sizing: border-box;
        }

        /* --- TEMPLATE CSS --- */
        /* Common */
        .resume-page { color: var(--text-dark); }
        .resume-page h1, .resume-page h2, .resume-page h3, .resume-page h4 { color: var(--text-dark); }
        
        /* Modern */
        .template-modern { display: flex; }
        .template-modern .left-col { width: 32%; background-color: #f1f5f9; padding: 25px; border-right: 1px solid #e2e8f0; display: flex; flex-direction: column; }
        .template-modern .right-col { width: 68%; padding: 30px; }
        .template-modern .photo-container { text-align: center; margin-bottom: 20px; }
        .template-modern .photo-circle { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: block; margin: 0 auto; background: #ddd; }
        .template-modern h1 { font-size: 28px; font-weight: 700; line-height: 1.2; margin-bottom: 5px; }
        .template-modern .job-title { font-size: 16px; color: var(--text-muted); margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px; }
        .template-modern h3 { font-size: 14px; text-transform: uppercase; letter-spacing: 1px; border-bottom: 2px solid; padding-bottom: 5px; margin-bottom: 15px; margin-top: 20px; font-weight: 700; }
        .template-modern .contact-item { font-size: 12px; margin-bottom: 8px; display: flex; align-items: center; color: var(--text-dark); }
        .template-modern .contact-item i { width: 20px; opacity: 0.8; }
        .template-modern .item-block { margin-bottom: 15px; }
        .template-modern .item-title { font-weight: 700; font-size: 15px; }
        .template-modern .item-subtitle { font-size: 13px; color: var(--text-muted); font-style: italic; margin-bottom: 4px; }
        .template-modern .item-desc { font-size: 13px; line-height: 1.5; }
        .template-modern ul { padding-left: 18px; margin: 0; }
        .template-modern li { margin-bottom: 4px; }
        .template-modern .skill-tag { display: inline-block; background: #e2e8f0; padding: 3px 8px; border-radius: 4px; font-size: 12px; margin: 0 4px 4px 0; color: var(--text-dark); }

        /* Classic */
        .template-classic { padding: 40px 50px; font-family: 'Merriweather', serif; }
        .template-classic .header { text-align: center; border-bottom: 1px solid #000; padding-bottom: 20px; margin-bottom: 25px; }
        .template-classic h1 { font-size: 32px; margin-bottom: 10px; }
        .template-classic .contact-line { font-size: 12px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; font-family: 'Inter', sans-serif; color: #444; }
        .template-classic h3 { font-family: 'Inter', sans-serif; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid #ccc; padding-bottom: 3px; margin: 25px 0 15px 0; font-weight: 700; }
        .template-classic .item-block { margin-bottom: 15px; }
        .template-classic .item-header { display: flex; justify-content: space-between; align-items: baseline; }
        .template-classic .item-title { font-weight: 700; font-size: 16px; }
        .template-classic .item-date { font-size: 13px; font-style: italic; color: #666; }
        .template-classic .item-subtitle { font-size: 14px; margin-bottom: 5px; color: #444; }
        .template-classic .item-desc { font-size: 14px; line-height: 1.6; font-family: 'Inter', sans-serif; color: #333; }
        .template-classic ul { padding-left: 20px; margin-top: 5px; }

        /* Minimal */
        .template-minimal { padding: 40px; font-family: 'Inter', sans-serif; }
        .template-minimal .header { margin-bottom: 30px; }
        .template-minimal h1 { font-size: 36px; font-weight: 300; letter-spacing: -1px; margin-bottom: 5px; }
        .template-minimal .role { font-size: 18px; color: #555; margin-bottom: 15px; }
        .template-minimal .contact-info { font-size: 13px; color: #555; display: flex; gap: 20px; }
        .template-minimal h3 { font-size: 16px; font-weight: 600; text-transform: uppercase; margin: 30px 0 15px 0; letter-spacing: 1px; display: flex; align-items: center; }
        .template-minimal h3::after { content: ''; flex: 1; height: 1px; background: #ddd; margin-left: 15px; }
        .template-minimal .grid-layout { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .template-minimal .item-block { display: grid; grid-template-columns: 120px 1fr; gap: 20px; margin-bottom: 15px; }
        .template-minimal .date-col { font-size: 13px; color: #666; text-align: right; padding-top: 3px; }
        .template-minimal .item-title { font-weight: 600; font-size: 15px; }
        .template-minimal .item-sub { font-size: 14px; color: #333; margin-bottom: 5px; }
        .template-minimal .item-desc { font-size: 13px; line-height: 1.5; color: #444; }
        .template-minimal .skills-grid { display: flex; flex-wrap: wrap; gap: 10px; margin-left: 140px; }
        .template-minimal .skill-pill { border: 1px solid #333; padding: 4px 10px; font-size: 12px; border-radius: 20px; }

        /* Creative */
        .template-creative { display: flex; flex-direction: column; font-family: 'Merriweather', serif; }
        .template-creative .header-block { color: white; padding: 30px; text-align: center; margin-bottom: 20px; }
        .template-creative h1 { font-family: 'Montserrat', sans-serif; letter-spacing: 3px; text-transform: uppercase; margin: 0; font-size: 32px; font-weight: 400; color: white; }
        .template-creative .job-title { font-family: 'Montserrat', sans-serif; letter-spacing: 2px; font-size: 13px; margin-top: 10px; text-transform: uppercase; color: rgba(255,255,255,0.9); }
        .template-creative .content-container { display: flex; padding: 0 40px 40px 40px; }
        .template-creative .left-col { width: 35%; padding-right: 30px; text-align: right; border-right: 1px solid #cbd5e1; position: relative; }
        .template-creative .right-col { width: 65%; padding-left: 30px; text-align: left; }
        .template-creative .photo-placeholder { width: 100px; height: 100px; background: #eee; border-radius: 50%; margin: -60px auto 20px auto; border: 4px solid white; display: flex; align-items: center; justify-content: center; color: #ccc; font-size: 40px; position: relative; z-index: 5; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow: hidden; }
        .template-creative .photo-placeholder img { width: 100%; height: 100%; object-fit: cover; }
        .template-creative h3 { font-family: 'Montserrat', sans-serif; font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 20px; position: relative; display: flex; align-items: center; color: var(--text-dark); }
        .template-creative .left-col h3 { justify-content: flex-end; }
        .template-creative .left-col h3::after { content: ''; position: absolute; right: -35px; width: 9px; height: 9px; border-radius: 50%; background: currentColor; }
        .template-creative .right-col h3::before { content: ''; position: absolute; left: -35px; width: 9px; height: 9px; border-radius: 50%; background: currentColor; }
        .template-creative .item-title { font-weight: 700; font-size: 15px; font-family: 'Montserrat', sans-serif; }
        .template-creative .item-subtitle { font-style: italic; font-size: 13px; margin-bottom: 5px; color: #555; }
        .template-creative .item-desc { font-size: 13px; line-height: 1.6; }
        
        /* Teal / Modern Color */
        .template-teal { display: flex; font-family: 'Inter', sans-serif; }
        .template-teal .left-col { width: 35%; padding: 40px 25px; display: flex; flex-direction: column; color: var(--text-dark); }
        .template-teal .right-col { width: 65%; padding: 40px 30px; background: white; }
        .template-teal .photo-area { display: flex; justify-content: center; margin-bottom: 20px; }
        .template-teal .photo-placeholder { width: 120px; height: 120px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 60px; border: 4px solid; overflow: hidden; color: #ccc; }
        .template-teal .photo-placeholder img { width: 100%; height: 100%; object-fit: cover; }
        .template-teal .header-block { margin-bottom: 40px; }
        .template-teal h1 { font-size: 42px; font-weight: 800; line-height: 1; color: #000; margin-bottom: 10px; font-family: 'Montserrat', sans-serif; }
        .template-teal .job-title-bar { color: white; padding: 8px 15px; display: inline-block; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; width: 100%; font-weight: 600; }
        .template-teal h3 { font-size: 15px; text-transform: uppercase; font-weight: 700; border-bottom: 2px solid; padding-bottom: 5px; margin-bottom: 15px; color: var(--text-dark); letter-spacing: 0.5px; }
        .template-teal .contact-item { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; font-size: 13px; font-weight: 500; color: var(--text-dark); }
        .template-teal .item-title { font-weight: 800; font-size: 15px; text-transform: uppercase; }
        .template-teal .item-subtitle { font-size: 13px; color: #666; margin-bottom: 8px; font-style: italic; }
        .template-teal .item-desc { font-size: 13px; line-height: 1.5; color: #333; }
        .template-teal .check-item { margin-bottom: 5px; font-size: 14px; display: flex; align-items: center; color: var(--text-dark); }
        .template-teal .check-item::before { content: '✓'; margin-right: 8px; font-weight: bold; }

        /* --- Helper Classes --- */
        .hidden { display: none !important; }

        /* --- Responsive Design --- */
        @media (max-width: 992px) {
            .editor-panel { width: 100%; position: relative; height: auto; border-right: none; overflow: visible; }
            .preview-panel { width: 100%; height: auto; padding: 20px 0; background: #e5e7eb; }
            .resume-page { transform: scale(0.9); transform-origin: top center; margin-bottom: 20px; } 
        }

        /* --- PRINT MEDIA QUERY --- */
        @media print {
            body { background: white; height: auto; margin: 0; }
            .editor-panel, .editor-header, .no-print { display: none !important; }
            .preview-panel { width: 100%; height: auto; background: white; padding: 0; margin: 0; display: block; overflow: visible; }
            .resume-page { width: 100%; margin: 0; box-shadow: none; transform: none !important; min-height: auto; page-break-after: always; }
            @page { margin: 0; size: auto; }
        }
    </style>
</head>
<body>

<div class="app-container">
    <div class="editor-panel">
        <div class="editor-header">
            <div class="top-bar">
                <h4 class="m-0 text-primary fw-bold"><i class="fas fa-layer-group me-2"></i>Resume Builder</h4>
                <button class="btn btn-sm btn-light text-danger" onclick="resetData()" title="Clear Data"><i class="fas fa-trash-alt"></i> Reset</button>
            </div>
            
            <div class="action-bar">
                <button class="download-btn" onclick="downloadPDF()">
                    <i class="fas fa-file-download fa-lg"></i>
                    <span style="font-size: 1.1rem;">Save as PDF</span>
                </button>
                <div class="d-flex align-items-center gap-2 mt-2">
                    <select id="templateSelector" class="form-select form-select-sm" style="flex:2;" onchange="updateTemplate()">
                        <option value="template-modern">Template: Modern</option>
                        <option value="template-classic">Template: Classic</option>
                        <option value="template-minimal">Template: Minimal</option>
                        <option value="template-creative">Template: Creative</option>
                        <option value="template-teal">Template: Modern Color</option>
                    </select>
                    <div style="flex:1; display:flex; align-items:center;">
                         <input type="color" class="form-control form-control-color" id="colorPicker" value="#2563eb" title="Choose Theme Color" onchange="updateThemeColor(this.value)" style="width:100%;">
                    </div>
                </div>
            </div>
        </div>

        <div class="editor-content">
            
            <div class="section-card">
                <div class="section-header" onclick="toggleSection('personal-body')">
                    <span><i class="fas fa-user-circle me-2 text-primary"></i> Personal Details</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="section-body open" id="personal-body">
                    <div class="mb-3">
                        <label class="form-label">Profile Photo (Auto-Resized)</label>
                        <input type="file" class="form-control" accept="image/*" onchange="handleImageUpload(this)">
                        <div id="image-preview-area" class="mt-2 hidden">
                            <img id="image-preview" src="" style="width:60px; height:60px; object-fit:cover; border-radius:50%; border:2px solid #ddd;">
                            <button class="btn btn-sm btn-outline-danger ms-2" style="font-size:0.8rem" onclick="removeImage()">Remove Photo</button>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-control" data-model="personal.name" oninput="updateState()">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Job Title / Tagline</label>
                        <input type="text" class="form-control" placeholder="e.g. Aspiring Web Developer" data-model="personal.title" oninput="updateState()">
                    </div>
                    <div class="row">
                        <div class="col-6 mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" data-model="personal.email" oninput="updateState()">
                        </div>
                        <div class="col-6 mb-3">
                            <label class="form-label">Phone</label>
                            <input type="text" class="form-control" data-model="personal.phone" oninput="updateState()">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">City, Country</label>
                        <input type="text" class="form-control" data-model="personal.location" oninput="updateState()">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">LinkedIn / Portfolio URL</label>
                        <input type="text" class="form-control" data-model="personal.link" oninput="updateState()">
                        
                        <div class="form-check mt-2">
                            <input class="form-check-input" type="checkbox" id="showQRCheck" onchange="updateQRState(this)">
                            <label class="form-check-label small text-muted" for="showQRCheck">
                                Show QR Code on Resume
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section-card">
                <div class="section-header" onclick="toggleSection('summary-body')">
                    <span><i class="fas fa-align-left me-2 text-primary"></i> Professional Summary</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="section-body" id="summary-body">
                    <div class="mb-3">
                        <textarea class="form-control" rows="4" data-model="summary" oninput="updateState()" placeholder="Motivated Computer Science graduate..."></textarea>
                        <div class="form-text text-muted small mt-1">Tip: Keep it to 2-3 sentences highlighting your passion and key academic achievements.</div>
                    </div>
                </div>
            </div>

            <div class="section-card">
                <div class="section-header" onclick="toggleSection('education-body')">
                    <span><i class="fas fa-graduation-cap me-2 text-primary"></i> Education</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="section-body" id="education-body">
                    <div id="education-list"></div>
                    <button class="btn btn-outline-primary btn-sm w-100" onclick="addItem('education')"><i class="fas fa-plus"></i> Add Education</button>
                </div>
            </div>

            <div class="section-card">
                <div class="section-header" onclick="toggleSection('skills-body')">
                    <span><i class="fas fa-tools me-2 text-primary"></i> Skills</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="section-body" id="skills-body">
                    <div class="mb-3">
                        <label class="form-label">Technical Skills (Comma separated)</label>
                        <textarea class="form-control" rows="3" data-model="skills" oninput="updateState()" placeholder="HTML, CSS, JavaScript, React, Python, SQL..."></textarea>
                    </div>
                </div>
            </div>

            <div class="section-card">
                <div class="section-header" onclick="toggleSection('languages-body')">
                    <span><i class="fas fa-language me-2 text-primary"></i> Languages</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="section-body" id="languages-body">
                    <div class="mb-3">
                        <label class="form-label">Languages (Comma separated)</label>
                        <input type="text" class="form-control" data-model="languages" oninput="updateState()" placeholder="English (Professional), Nepali (Native), Hindi (Conversational)...">
                    </div>
                </div>
            </div>

            <div class="section-card">
                <div class="section-header" onclick="toggleSection('projects-body')">
                    <span><i class="fas fa-laptop-code me-2 text-primary"></i> Experience & Projects</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="section-body" id="projects-body">
                    <div class="form-check mb-3">
                         <input class="form-check-input" type="checkbox" id="showExpCheck" onchange="updateExpState(this)">
                         <label class="form-check-label small text-muted" for="showExpCheck">
                             Show "Experience" Section on Resume
                         </label>
                    </div>
                    
                    <div class="alert alert-info py-2" style="font-size: 0.8rem;">
                        <i class="fas fa-info-circle"></i> Include academic projects, volunteer work, or internships.
                    </div>
                    <div id="projects-list"></div>
                    <button class="btn btn-outline-primary btn-sm w-100" onclick="addItem('projects')"><i class="fas fa-plus"></i> Add Experience/Project</button>
                </div>
            </div>

            <div class="section-card">
                <div class="section-header" onclick="toggleSection('achievements-body')">
                    <span><i class="fas fa-trophy me-2 text-primary"></i> Achievements & Activities</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="section-body" id="achievements-body">
                     <div class="alert alert-info py-2" style="font-size: 0.8rem;">
                        <i class="fas fa-info-circle"></i> Great for filling space: Hackathons, Volunteering, Workshops, Clubs.
                    </div>
                    <div id="achievements-list"></div>
                    <button class="btn btn-outline-primary btn-sm w-100" onclick="addItem('achievements')"><i class="fas fa-plus"></i> Add Activity</button>
                </div>
            </div>

            <div class="section-card">
                <div class="section-header" onclick="toggleSection('certs-body')">
                    <span><i class="fas fa-certificate me-2 text-primary"></i> Certifications</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="section-body" id="certs-body">
                    <div id="certs-list"></div>
                    <button class="btn btn-outline-primary btn-sm w-100" onclick="addItem('certs')"><i class="fas fa-plus"></i> Add Certificate</button>
                </div>
            </div>
            
            <div class="section-card">
                <div class="section-header" onclick="toggleSection('declaration-body')">
                    <span><i class="fas fa-signature me-2 text-primary"></i> Declaration</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="section-body" id="declaration-body">
                    <div class="mb-3">
                        <label class="form-label">Declaration Statement</label>
                        <textarea class="form-control" rows="3" data-model="declaration" oninput="updateState()"></textarea>
                        <div class="form-text text-muted small mt-1">Clear this text to hide the declaration section.</div>
                    </div>
                </div>
            </div>

        </div>
        <div class="p-3 text-center text-muted small">
            <p>100% Client-Side • No Data Uploaded</p>
        </div>
    </div>

    <div class="preview-panel">
        <div id="resume-preview" class="resume-page template-modern">
            </div>
    </div>
</div>

<script>
    // --- Data & State Management ---
    const defaultData = {
        template: 'template-modern',
        themeColor: '#2563eb', // Default Blue
        showExperience: true,
        personal: {
            name: 'Alex Johnson',
            title: 'Junior Web Developer',
            email: 'alex.j@example.com',
            phone: '+1 234 567 8900',
            location: 'New York, USA',
            link: 'linkedin.com/in/alexj',
            showQR: true,
            profileImage: ''
        },
        summary: 'Enthusiastic and detail-oriented Computer Science graduate with a strong foundation in front-end development technologies. Passionate about building user-friendly web interfaces and eager to contribute to a dynamic development team. Proficient in HTML, CSS, and JavaScript with hands-on experience in academic projects.',
        skills: 'HTML5, CSS3, JavaScript (ES6+), Bootstrap, Git, Figma, Python, Basic React',
        languages: 'English (Professional), Spanish (Conversational)',
        declaration: 'I hereby declare that the information furnished above is true, complete, and correct to the best of my knowledge and belief.',
        education: [
            {
                institution: 'State University',
                degree: 'Bachelor of Science in Computer Science',
                year: '2021 - 2025',
                details: 'GPA: 3.8/4.0 | Relevant Coursework: Web Development, Data Structures, UI/UX Design'
            }
        ],
        projects: [
            {
                title: 'E-Commerce Website (Academic Project)',
                role: 'Frontend Developer',
                year: 'Jan 2025 - Mar 2025',
                description: '• Developed a responsive e-commerce interface using HTML, CSS, and Vanilla JS.\n• Implemented cart functionality and product filtering logic.\n• Optimized page load speed achieving a 95+ Lighthouse score.'
            }
        ],
        achievements: [
            {
                title: '1st Place, University Coding Hackathon',
                year: '2024',
                description: 'Led a team of 4 to build a sustainable energy tracker app in 24 hours.'
            },
            {
                title: 'Volunteer Tech Tutor',
                year: '2023',
                description: 'Taught basic computer skills to senior citizens at the local library.'
            }
        ],
        certs: [
            {
                name: 'Responsive Web Design Certification',
                issuer: 'freeCodeCamp',
                year: '2024'
            }
        ]
    };

    let resumeData = {};

    // --- Helper to create light shade of color ---
    function hexToRgba(hex, alpha) {
        let c;
        if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)){
            c= hex.substring(1).split('');
            if(c.length== 3){
                c= [c[0], c[0], c[1], c[1], c[2], c[2]];
            }
            c= '0x'+c.join('');
            return 'rgba('+[(c>>16)&255, (c>>8)&255, c&255].join(',')+','+alpha+')';
        }
        return hex;
    }

    // --- Initialization ---
    window.addEventListener('DOMContentLoaded', () => {
        loadState();
        renderForm();
        renderPreview();
    });

    // --- Core Logic ---

    function loadState() {
        const saved = localStorage.getItem('resumeBuilderData'); // Renamed key
        if (saved) {
            resumeData = JSON.parse(saved);
            // Compatibility Checks
            if (resumeData.personal && typeof resumeData.personal.showQR === 'undefined') {
                resumeData.personal.showQR = true;
            }
            if (resumeData.personal && typeof resumeData.personal.profileImage === 'undefined') {
                resumeData.personal.profileImage = '';
            }
            if (typeof resumeData.showExperience === 'undefined') resumeData.showExperience = true;
            if (typeof resumeData.themeColor === 'undefined') resumeData.themeColor = defaultData.themeColor;
            if (typeof resumeData.languages === 'undefined') resumeData.languages = '';
            if (typeof resumeData.achievements === 'undefined') resumeData.achievements = [];
            if (typeof resumeData.declaration === 'undefined') resumeData.declaration = defaultData.declaration;
        } else {
            resumeData = JSON.parse(JSON.stringify(defaultData)); // Deep copy
        }
        document.getElementById('templateSelector').value = resumeData.template || 'template-modern';
        document.getElementById('colorPicker').value = resumeData.themeColor || '#2563eb';
    }

    function saveState() {
        try {
            localStorage.setItem('resumeBuilderData', JSON.stringify(resumeData));
            renderPreview();
        } catch (e) {
            alert("Error saving data: LocalStorage quota exceeded. Please try removing the photo or reducing text.");
        }
    }

    function updateState() {
        document.querySelectorAll('[data-model]').forEach(input => {
            const path = input.getAttribute('data-model').split('.');
            if (path.length === 1) {
                resumeData[path[0]] = input.value;
            } else if (path.length === 2) {
                resumeData[path[0]][path[1]] = input.value;
            }
        });
        saveState();
    }
    
    // --- Image Handling with Compression ---
    function handleImageUpload(input) {
        const file = input.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;
                    const MAX_WIDTH = 400;
                    const MAX_HEIGHT = 400;
                    if (width > height) {
                        if (width > MAX_WIDTH) { height *= MAX_WIDTH / width; width = MAX_WIDTH; }
                    } else {
                        if (height > MAX_HEIGHT) { width *= MAX_HEIGHT / height; height = MAX_HEIGHT; }
                    }
                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    const compressedBase64 = canvas.toDataURL('image/jpeg', 0.7);
                    resumeData.personal.profileImage = compressedBase64;
                    saveState();
                    renderPreview();
                    updateImagePreviewUI();
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
    }

    function removeImage() {
        resumeData.personal.profileImage = '';
        saveState();
        renderPreview();
        updateImagePreviewUI();
        document.querySelector('input[type="file"]').value = '';
    }

    function updateImagePreviewUI() {
        const previewArea = document.getElementById('image-preview-area');
        const img = document.getElementById('image-preview');
        
        if (resumeData.personal.profileImage) {
            img.src = resumeData.personal.profileImage;
            previewArea.classList.remove('hidden');
        } else {
            previewArea.classList.add('hidden');
        }
    }

    function updateQRState(el) {
        resumeData.personal.showQR = el.checked;
        saveState();
        renderPreview();
    }
    
    function updateExpState(el) {
        resumeData.showExperience = el.checked;
        saveState();
        renderPreview();
    }
    
    function updateThemeColor(color) {
        resumeData.themeColor = color;
        saveState();
        renderPreview();
    }

    function resetData() {
        if(confirm("Are you sure you want to clear all data and reset to default?")) {
            localStorage.removeItem('resumeBuilderData');
            loadState();
            renderForm();
            renderPreview();
        }
    }

    // --- PDF DOWNLOAD FUNCTIONALITY ---
    function downloadPDF() {
        const originalTitle = document.title;
        const name = resumeData.personal.name || 'Resume';
        const safeName = name.replace(/[^a-zA-Z0-9\s]/g, '').trim().replace(/\s+/g, '_');
        document.title = `Resume_${safeName}`;
        setTimeout(() => {
            window.print();
            setTimeout(() => {
                document.title = originalTitle;
            }, 2000);
        }, 100);
    }

    function updateTemplate() {
        const selector = document.getElementById('templateSelector');
        resumeData.template = selector.value;
        saveState();
    }

    // --- Form Rendering ---

    function toggleSection(id) {
        const el = document.getElementById(id);
        const icon = el.previousElementSibling.querySelector('.fa-chevron-down');
        if (el.classList.contains('open')) {
            el.classList.remove('open');
            icon.style.transform = 'rotate(0deg)';
        } else {
            el.classList.add('open');
            icon.style.transform = 'rotate(180deg)';
        }
    }

    function renderForm() {
        document.querySelector('[data-model="personal.name"]').value = resumeData.personal.name;
        document.querySelector('[data-model="personal.title"]').value = resumeData.personal.title;
        document.querySelector('[data-model="personal.email"]').value = resumeData.personal.email;
        document.querySelector('[data-model="personal.phone"]').value = resumeData.personal.phone;
        document.querySelector('[data-model="personal.location"]').value = resumeData.personal.location;
        document.querySelector('[data-model="personal.link"]').value = resumeData.personal.link;
        document.querySelector('[data-model="summary"]').value = resumeData.summary;
        document.querySelector('[data-model="skills"]').value = resumeData.skills;
        document.querySelector('[data-model="languages"]').value = resumeData.languages || '';
        document.querySelector('[data-model="declaration"]').value = resumeData.declaration || '';

        const qrCheck = document.getElementById('showQRCheck');
        if(qrCheck) qrCheck.checked = resumeData.personal.showQR;
        
        const expCheck = document.getElementById('showExpCheck');
        if(expCheck) expCheck.checked = resumeData.showExperience;
        
        document.getElementById('colorPicker').value = resumeData.themeColor || '#2563eb';
        
        updateImagePreviewUI();

        renderDynamicList('education', resumeData.education, (item, i) => `
            <div class="row">
                <div class="col-12 mb-2"><input type="text" class="form-control" placeholder="Institution/School" value="${item.institution}" oninput="updateList('education', ${i}, 'institution', this.value)"></div>
                <div class="col-12 mb-2"><input type="text" class="form-control" placeholder="Degree/Course" value="${item.degree}" oninput="updateList('education', ${i}, 'degree', this.value)"></div>
                <div class="col-6 mb-2"><input type="text" class="form-control" placeholder="Year" value="${item.year}" oninput="updateList('education', ${i}, 'year', this.value)"></div>
                <div class="col-12"><textarea class="form-control" placeholder="Details (GPA, Honors...)" rows="2" oninput="updateList('education', ${i}, 'details', this.value)">${item.details}</textarea></div>
            </div>
        `);

        renderDynamicList('projects', resumeData.projects, (item, i) => `
             <div class="row">
                <div class="col-12 mb-2"><input type="text" class="form-control" placeholder="Project Title / Company" value="${item.title}" oninput="updateList('projects', ${i}, 'title', this.value)"></div>
                <div class="col-6 mb-2"><input type="text" class="form-control" placeholder="Role" value="${item.role}" oninput="updateList('projects', ${i}, 'role', this.value)"></div>
                <div class="col-6 mb-2"><input type="text" class="form-control" placeholder="Date" value="${item.year}" oninput="updateList('projects', ${i}, 'year', this.value)"></div>
                <div class="col-12"><textarea class="form-control" placeholder="Description (Bullet points)" rows="3" oninput="updateList('projects', ${i}, 'description', this.value)">${item.description}</textarea></div>
            </div>
        `);

        renderDynamicList('achievements', resumeData.achievements, (item, i) => `
             <div class="row">
                <div class="col-12 mb-2"><input type="text" class="form-control" placeholder="Achievement / Activity Title" value="${item.title}" oninput="updateList('achievements', ${i}, 'title', this.value)"></div>
                <div class="col-6 mb-2"><input type="text" class="form-control" placeholder="Year" value="${item.year}" oninput="updateList('achievements', ${i}, 'year', this.value)"></div>
                <div class="col-12"><textarea class="form-control" placeholder="Description" rows="2" oninput="updateList('achievements', ${i}, 'description', this.value)">${item.description}</textarea></div>
            </div>
        `);

        renderDynamicList('certs', resumeData.certs, (item, i) => `
             <div class="row">
                <div class="col-12 mb-2"><input type="text" class="form-control" placeholder="Certification Name" value="${item.name}" oninput="updateList('certs', ${i}, 'name', this.value)"></div>
                <div class="col-6 mb-2"><input type="text" class="form-control" placeholder="Issuer" value="${item.issuer}" oninput="updateList('certs', ${i}, 'issuer', this.value)"></div>
                <div class="col-6 mb-2"><input type="text" class="form-control" placeholder="Year" value="${item.year}" oninput="updateList('certs', ${i}, 'year', this.value)"></div>
            </div>
        `);
    }

    function renderDynamicList(key, list, templateFn) {
        const container = document.getElementById(`${key}-list`);
        container.innerHTML = '';
        list.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'dynamic-item';
            div.innerHTML = `
                <button class="remove-btn" onclick="removeItem('${key}', ${index})"><i class="fas fa-times"></i></button>
                ${templateFn(item, index)}
            `;
            container.appendChild(div);
        });
    }

    function addItem(section) {
        let newItem = {};
        if (section === 'education') newItem = { institution: '', degree: '', year: '', details: '' };
        if (section === 'projects') newItem = { title: '', role: '', year: '', description: '' };
        if (section === 'achievements') newItem = { title: '', year: '', description: '' };
        if (section === 'certs') newItem = { name: '', issuer: '', year: '' };
        
        resumeData[section].push(newItem);
        saveState();
        renderForm();
    }

    function removeItem(section, index) {
        resumeData[section].splice(index, 1);
        saveState();
        renderForm();
    }

    function updateList(section, index, key, value) {
        resumeData[section][index][key] = value;
        saveState();
    }

    // --- Preview Generation ---

    function renderPreview() {
        const container = document.getElementById('resume-preview');
        container.className = `resume-page ${resumeData.template}`;
        
        const formatDesc = (text) => {
            if (!text) return '';
            const lines = text.split('\n');
            if (lines.length > 1) {
                return '<ul>' + lines.map(l => l.trim() ? `<li>${l.replace(/^[•-]\s*/, '')}</li>` : '').join('') + '</ul>';
            }
            return text;
        };

        const formatSkills = (text, isPill) => {
            if (!text) return '';
            const list = text.split(',').map(s => s.trim()).filter(s => s);
            if (isPill) {
                return list.map(s => `<span class="skill-tag">${s}</span>`).join('');
            }
            return list.join(' • ');
        };
        
        const formatCheckList = (text) => {
             if (!text) return '';
            const list = text.split(',').map(s => s.trim()).filter(s => s);
            return list.map(s => `<div class="check-item">${s}</div>`).join('');
        };
        
        // Theme Colors
        const themeColor = resumeData.themeColor || '#2563eb';
        const lightThemeColor = hexToRgba(themeColor, 0.1);

        let html = '';

        if (resumeData.template === 'template-modern') {
            html = `
                <div class="left-col">
                    ${resumeData.personal.profileImage ?
                        `<div class="photo-container"><img src="${resumeData.personal.profileImage}" class="photo-circle" style="border-color:${themeColor}"></div>` : ''
                    }

                    <div class="contact-section">
                        <h3 style="border-bottom-color:#cbd5e1; color:${themeColor}">Contact</h3>
                        ${resumeData.personal.email ? `<div class="contact-item"><i class="fas fa-envelope" style="color:${themeColor}"></i> <a href="mailto:${resumeData.personal.email}" style="color:inherit; text-decoration:none;">${resumeData.personal.email}</a></div>` : ''}
                        ${resumeData.personal.phone ? `<div class="contact-item"><i class="fas fa-phone" style="color:${themeColor}"></i> ${resumeData.personal.phone}</div>` : ''}
                        ${resumeData.personal.location ? `<div class="contact-item"><i class="fas fa-map-marker-alt" style="color:${themeColor}"></i> ${resumeData.personal.location}</div>` : ''}
                        ${resumeData.personal.link ? `<div class="contact-item"><i class="fas fa-link" style="color:${themeColor}"></i> ${resumeData.personal.link}</div>` : ''}
                    </div>
                    
                    ${resumeData.personal.link && resumeData.personal.showQR ? `<div class="mb-4 text-center mt-3"><img src="https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=${encodeURIComponent('https://'+resumeData.personal.link)}" alt="QR" style="width:80px; opacity:0.8"></div>` : ''}

                    <div class="skills-section">
                        <h3 style="border-bottom-color:#cbd5e1; color:${themeColor}">Skills</h3>
                        <div>${formatSkills(resumeData.skills, true)}</div>
                    </div>
                    
                    ${resumeData.languages ? `
                    <div class="skills-section">
                        <h3 style="border-bottom-color:#cbd5e1; color:${themeColor}">Languages</h3>
                        <div>${formatSkills(resumeData.languages, true)}</div>
                    </div>` : ''}

                    ${resumeData.certs.length > 0 ? `
                    <div class="cert-section">
                        <h3 style="border-bottom-color:#cbd5e1; color:${themeColor}">Certifications</h3>
                        ${resumeData.certs.map(c => `
                            <div class="mb-2">
                                <div style="font-weight:700; font-size:13px">${c.name}</div>
                                <div style="font-size:12px; color:#555">${c.issuer} ${c.year ? `(${c.year})` : ''}</div>
                            </div>
                        `).join('')}
                    </div>` : ''}
                </div>
                <div class="right-col">
                    <header>
                        <h1 style="color:#1e293b">${resumeData.personal.name}</h1>
                        <div class="job-title">${resumeData.personal.title}</div>
                        <p style="font-size:13px; line-height:1.5">${resumeData.summary}</p>
                    </header>

                    ${resumeData.showExperience && resumeData.projects.length > 0 ? `
                    <section>
                        <h3 style="border-bottom-color:#cbd5e1; color:${themeColor}">Experience & Projects</h3>
                        ${resumeData.projects.map(p => `
                            <div class="item-block">
                                <div class="d-flex justify-content-between">
                                    <div class="item-title">${p.title}</div>
                                    <div class="item-subtitle">${p.year}</div>
                                </div>
                                <div class="item-subtitle" style="color:${themeColor}">${p.role}</div>
                                <div class="item-desc">${formatDesc(p.description)}</div>
                            </div>
                        `).join('')}
                    </section>` : ''}
                    
                    ${resumeData.achievements.length > 0 ? `
                    <section>
                        <h3 style="border-bottom-color:#cbd5e1; color:${themeColor}">Achievements & Activities</h3>
                        ${resumeData.achievements.map(a => `
                            <div class="item-block">
                                <div class="d-flex justify-content-between">
                                    <div class="item-title">${a.title}</div>
                                    <div class="item-subtitle">${a.year}</div>
                                </div>
                                <div class="item-desc">${formatDesc(a.description)}</div>
                            </div>
                        `).join('')}
                    </section>` : ''}

                    ${resumeData.education.length > 0 ? `
                    <section>
                        <h3 style="border-bottom-color:#cbd5e1; color:${themeColor}">Education</h3>
                        ${resumeData.education.map(e => `
                            <div class="item-block">
                                <div class="d-flex justify-content-between">
                                    <div class="item-title">${e.institution}</div>
                                    <div class="item-subtitle">${e.year}</div>
                                </div>
                                <div class="item-desc" style="font-weight:500">${e.degree}</div>
                                <div class="item-desc text-muted">${e.details}</div>
                            </div>
                        `).join('')}
                    </section>` : ''}

                    ${resumeData.declaration ? `
                    <section class="mt-4">
                        <h3 style="border-bottom-color:#cbd5e1; color:${themeColor}">Declaration</h3>
                        <p style="font-size:13px; font-style:italic; color:#555">${resumeData.declaration}</p>
                    </section>` : ''}
                </div>
            `;
        } else if (resumeData.template === 'template-classic') {
            html = `
                <div class="header">
                    <h1>${resumeData.personal.name}</h1>
                    <div class="text-uppercase" style="letter-spacing:1px; font-size:14px; margin-bottom:10px">${resumeData.personal.title}</div>
                    <div class="contact-line">
                        ${resumeData.personal.email ? `<span>${resumeData.personal.email}</span>` : ''}
                        ${resumeData.personal.phone ? `<span>| ${resumeData.personal.phone}</span>` : ''}
                        ${resumeData.personal.location ? `<span>| ${resumeData.personal.location}</span>` : ''}
                        ${resumeData.personal.link ? `<span>| ${resumeData.personal.link}</span>` : ''}
                    </div>
                </div>

                <div class="section">
                    <h3 style="border-bottom:1px solid ${themeColor}; color:#000">Professional Summary</h3>
                    <p style="font-size:14px; line-height:1.6">${resumeData.summary}</p>
                </div>

                <div class="section">
                    <h3 style="border-bottom:1px solid ${themeColor}; color:#000">Skills</h3>
                    <p style="font-size:14px;">${formatSkills(resumeData.skills, false)}</p>
                </div>

                ${resumeData.languages ? `
                <div class="section">
                    <h3 style="border-bottom:1px solid ${themeColor}; color:#000">Languages</h3>
                    <p style="font-size:14px;">${resumeData.languages}</p>
                </div>` : ''}

                ${resumeData.showExperience && resumeData.projects.length > 0 ? `
                <div class="section">
                    <h3 style="border-bottom:1px solid ${themeColor}; color:#000">Experience & Projects</h3>
                    ${resumeData.projects.map(p => `
                        <div class="item-block">
                            <div class="item-header">
                                <span class="item-title">${p.title}</span>
                                <span class="item-date">${p.year}</span>
                            </div>
                            <div class="item-subtitle" style="font-style:italic">${p.role}</div>
                            <div class="item-desc">${formatDesc(p.description)}</div>
                        </div>
                    `).join('')}
                </div>` : ''}
                
                ${resumeData.achievements.length > 0 ? `
                <div class="section">
                    <h3 style="border-bottom:1px solid ${themeColor}; color:#000">Achievements & Activities</h3>
                    ${resumeData.achievements.map(a => `
                        <div class="item-block">
                            <div class="item-header">
                                <span class="item-title">${a.title}</span>
                                <span class="item-date">${a.year}</span>
                            </div>
                            <div class="item-desc">${formatDesc(a.description)}</div>
                        </div>
                    `).join('')}
                </div>` : ''}

                ${resumeData.education.length > 0 ? `
                <div class="section">
                    <h3 style="border-bottom:1px solid ${themeColor}; color:#000">Education</h3>
                    ${resumeData.education.map(e => `
                        <div class="item-block">
                            <div class="item-header">
                                <span class="item-title">${e.institution}</span>
                                <span class="item-date">${e.year}</span>
                            </div>
                            <div class="item-desc">${e.degree}</div>
                            <div class="item-desc" style="font-size:13px">${e.details}</div>
                        </div>
                    `).join('')}
                </div>` : ''}
                
                 ${resumeData.certs.length > 0 ? `
                <div class="section">
                    <h3 style="border-bottom:1px solid ${themeColor}; color:#000">Certifications</h3>
                    <ul style="font-size:14px">
                    ${resumeData.certs.map(c => `
                        <li><strong>${c.name}</strong> - ${c.issuer} (${c.year})</li>
                    `).join('')}
                    </ul>
                </div>` : ''}

                ${resumeData.declaration ? `
                <div class="section">
                    <h3 style="border-bottom:1px solid ${themeColor}; color:#000">Declaration</h3>
                    <p style="font-size:14px; font-style:italic;">${resumeData.declaration}</p>
                </div>` : ''}
            `;
        } else if (resumeData.template === 'template-minimal') {
            html = `
                <div class="header">
                    <h1>${resumeData.personal.name}</h1>
                    <div class="role">${resumeData.personal.title}</div>
                    <div class="contact-info">
                        ${resumeData.personal.email ? `<span><i class="far fa-envelope" style="color:${themeColor}"></i> ${resumeData.personal.email}</span>` : ''}
                        ${resumeData.personal.phone ? `<span><i class="fas fa-phone-alt" style="color:${themeColor}"></i> ${resumeData.personal.phone}</span>` : ''}
                        ${resumeData.personal.location ? `<span><i class="fas fa-map-marker-alt" style="color:${themeColor}"></i> ${resumeData.personal.location}</span>` : ''}
                    </div>
                </div>

                <div class="section">
                    <h3>Profile</h3>
                    <p style="font-size:13px; line-height:1.6; color:#444">${resumeData.summary}</p>
                </div>

                ${resumeData.showExperience && resumeData.projects.length > 0 ? `
                <div class="section">
                    <h3>Experience</h3>
                    <div class="grid-layout">
                    ${resumeData.projects.map(p => `
                        <div class="item-block">
                            <div class="date-col">${p.year}</div>
                            <div class="content-col">
                                <div class="item-title" style="color:${themeColor}">${p.title}</div>
                                <div class="item-sub">${p.role}</div>
                                <div class="item-desc">${formatDesc(p.description)}</div>
                            </div>
                        </div>
                    `).join('')}
                    </div>
                </div>` : ''}
                
                ${resumeData.achievements.length > 0 ? `
                <div class="section">
                    <h3>Achievements & Activities</h3>
                    <div class="grid-layout">
                    ${resumeData.achievements.map(a => `
                        <div class="item-block">
                            <div class="date-col">${a.year}</div>
                            <div class="content-col">
                                <div class="item-title" style="color:${themeColor}">${a.title}</div>
                                <div class="item-desc">${formatDesc(a.description)}</div>
                            </div>
                        </div>
                    `).join('')}
                    </div>
                </div>` : ''}

                ${resumeData.education.length > 0 ? `
                <div class="section">
                    <h3>Education</h3>
                    <div class="grid-layout">
                    ${resumeData.education.map(e => `
                        <div class="item-block">
                            <div class="date-col">${e.year}</div>
                            <div class="content-col">
                                <div class="item-title" style="color:${themeColor}">${e.institution}</div>
                                <div class="item-sub">${e.degree}</div>
                                <div class="item-desc text-muted">${e.details}</div>
                            </div>
                        </div>
                    `).join('')}
                    </div>
                </div>` : ''}

                <div class="section">
                    <h3>Skills</h3>
                    <div class="item-block">
                        <div class="date-col">Tech Stack</div>
                        <div class="skills-grid" style="margin-left:0; display:flex; gap:8px; flex-wrap:wrap;">
                            ${resumeData.skills.split(',').map(s => `<span class="skill-pill" style="border-color:${themeColor}; color:#333;">${s.trim()}</span>`).join('')}
                        </div>
                    </div>
                </div>
                
                ${resumeData.languages ? `
                <div class="section">
                    <h3>Languages</h3>
                    <div class="item-block">
                        <div class="date-col">Spoken</div>
                        <div class="skills-grid" style="margin-left:0; display:flex; gap:8px; flex-wrap:wrap;">
                            ${resumeData.languages.split(',').map(s => `<span class="skill-pill" style="border-color:${themeColor}; color:#333;">${s.trim()}</span>`).join('')}
                        </div>
                    </div>
                </div>` : ''}

                ${resumeData.declaration ? `
                <div class="section">
                    <h3>Declaration</h3>
                    <div class="item-block">
                        <div class="date-col"></div>
                        <div class="content-col">
                            <p style="font-size:13px; color:#444; font-style:italic">${resumeData.declaration}</p>
                        </div>
                    </div>
                </div>` : ''}
            `;
        } else if (resumeData.template === 'template-creative') {
            html = `
                <div class="header-block" style="background:${themeColor}">
                    <h1>${resumeData.personal.name}</h1>
                    <div class="job-title">${resumeData.personal.title}</div>
                </div>
                
                ${resumeData.personal.profileImage ?
                    `<div class="photo-placeholder"><img src="${resumeData.personal.profileImage}"></div>` :
                    `<div class="photo-placeholder"><i class="fas fa-user-circle"></i></div>`
                }

                <div class="content-container">
                    <div class="left-col">
                        <h3 style="color:${themeColor}">Summary</h3>
                        <p style="font-size:13px; line-height:1.6; margin-bottom:20px;">${resumeData.summary}</p>

                        <h3 style="color:${themeColor}">Education</h3>
                         ${resumeData.education.map(e => `
                            <div class="mb-3">
                                <div style="font-weight:700; font-size:14px;">${e.degree}</div>
                                <div style="font-size:13px; font-style:italic;">${e.institution}</div>
                                <div style="font-size:13px; color:#666;">${e.year}</div>
                            </div>
                        `).join('')}
                        
                         ${resumeData.skills ? `
                        <h3 style="color:${themeColor}">Relevant Skills</h3>
                        <div style="font-size:14px;">${formatCheckList(resumeData.skills)}</div>
                        ` : ''}
                        
                        ${resumeData.languages ? `
                        <h3 class="mt-3" style="color:${themeColor}">Languages</h3>
                        <div style="font-size:14px;">${formatCheckList(resumeData.languages)}</div>
                        ` : ''}

                        ${resumeData.personal.showQR && resumeData.personal.link ? `
                        <div class="mt-4 d-flex justify-content-end">
                            <img src="https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=${encodeURIComponent('https://'+resumeData.personal.link)}" alt="QR" style="width:80px;">
                        </div>` : ''}
                    </div>

                    <div class="right-col">
                        <h3 style="color:${themeColor}">Contact</h3>
                        <div style="margin-bottom:25px; font-size:13px;">
                            ${resumeData.personal.phone ? `<div><i class="fas fa-phone me-2 text-muted"></i> ${resumeData.personal.phone}</div>` : ''}
                            ${resumeData.personal.email ? `<div><i class="fas fa-envelope me-2 text-muted"></i> ${resumeData.personal.email}</div>` : ''}
                            ${resumeData.personal.location ? `<div><i class="fas fa-map-marker-alt me-2 text-muted"></i> ${resumeData.personal.location}</div>` : ''}
                            ${resumeData.personal.link ? `<div><i class="fas fa-link me-2 text-muted"></i> ${resumeData.personal.link}</div>` : ''}
                        </div>

                        ${resumeData.showExperience && resumeData.projects.length > 0 ? `
                        <h3 style="color:${themeColor}">Professional Experience</h3>
                         ${resumeData.projects.map(p => `
                            <div class="mb-4">
                                <div class="item-title">${p.role}</div>
                                <div class="item-subtitle">${p.title} | ${p.year}</div>
                                <div class="item-desc">${formatDesc(p.description)}</div>
                            </div>
                        `).join('')}` : ''}

                        ${resumeData.achievements.length > 0 ? `
                        <h3 style="color:${themeColor}">Activities</h3>
                         ${resumeData.achievements.map(a => `
                            <div class="mb-3">
                                <div class="item-title" style="font-size:14px">${a.title}</div>
                                <div class="item-subtitle">${a.year}</div>
                                <div class="item-desc">${formatDesc(a.description)}</div>
                            </div>
                        `).join('')}` : ''}
                        
                        ${resumeData.declaration ? `
                        <div class="mt-4">
                             <h3 style="color:${themeColor}">Declaration</h3>
                            <p style="font-size:12px; font-style:italic;">${resumeData.declaration}</p>
                        </div>` : ''}
                    </div>
                </div>
            `;
        } else if (resumeData.template === 'template-teal') {
             html = `
                <div class="left-col" style="background-color:${lightThemeColor}; color:#1e293b;">
                    <div class="photo-area">
                         ${resumeData.personal.profileImage ?
                            `<div class="photo-placeholder" style="border-color:${themeColor}"><img src="${resumeData.personal.profileImage}"></div>` :
                            `<div class="photo-placeholder" style="border-color:${themeColor}"><i class="fas fa-user" style="color:#ccc"></i></div>`
                        }
                    </div>
                    
                    <div style="margin-bottom:30px">
                        <h3 style="border-bottom-color:${themeColor}; color:#1e293b;">Contact</h3>
                        ${resumeData.personal.phone ? `<div class="contact-item" style="color:#1e293b;"><i class="fas fa-phone-alt"></i> ${resumeData.personal.phone}</div>` : ''}
                        ${resumeData.personal.email ? `<div class="contact-item" style="color:#1e293b;"><i class="fas fa-envelope"></i> ${resumeData.personal.email}</div>` : ''}
                        ${resumeData.personal.location ? `<div class="contact-item" style="color:#1e293b;"><i class="fas fa-map-marker-alt"></i> ${resumeData.personal.location}</div>` : ''}
                        ${resumeData.personal.link ? `<div class="contact-item" style="color:#1e293b;"><i class="fas fa-link"></i> ${resumeData.personal.link}</div>` : ''}
                         ${resumeData.personal.showQR && resumeData.personal.link ? `
                            <div class="mt-3 text-center">
                                <img src="https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=${encodeURIComponent('https://'+resumeData.personal.link)}" alt="QR" style="width:80px; opacity:0.8; mix-blend-mode: multiply;">
                            </div>` : ''}
                    </div>

                    <div style="margin-bottom:30px">
                        <h3 style="border-bottom-color:${themeColor}; color:#1e293b;">Profile Summary</h3>
                        <p style="font-size:13px; line-height:1.5;">${resumeData.summary}</p>
                    </div>

                    ${resumeData.skills ? `
                    <div style="margin-bottom:30px">
                        <h3 style="border-bottom-color:${themeColor}; color:#1e293b;">Skills</h3>
                         ${formatCheckList(resumeData.skills)}
                    </div>` : ''}

                    ${resumeData.languages ? `
                    <div style="margin-bottom:30px">
                        <h3 style="border-bottom-color:${themeColor}; color:#1e293b;">Languages</h3>
                         ${formatCheckList(resumeData.languages)}
                    </div>` : ''}
                </div>

                <div class="right-col">
                    <div class="header-block">
                        <h1>${resumeData.personal.name}</h1>
                        <div class="job-title-bar" style="background:${themeColor}">${resumeData.personal.title}</div>
                    </div>

                    ${resumeData.showExperience && resumeData.projects.length > 0 ? `
                    <div style="margin-bottom:30px">
                        <h3 style="border-bottom-color:${themeColor}">Professional Experience</h3>
                         ${resumeData.projects.map(p => `
                            <div style="margin-bottom:20px;">
                                <div class="item-title">${p.title}</div>
                                <div class="item-subtitle">${p.role}</div>
                                <div style="font-size:12px; color:${themeColor}; margin-bottom:5px; font-weight:600;">${p.year}</div>
                                <div class="item-desc">${formatDesc(p.description)}</div>
                            </div>
                        `).join('')}
                    </div>` : ''}
                    
                     ${resumeData.achievements.length > 0 ? `
                    <div style="margin-bottom:30px">
                        <h3 style="border-bottom-color:${themeColor}">Achievements</h3>
                         ${resumeData.achievements.map(a => `
                            <div style="margin-bottom:15px;">
                                <div class="item-title" style="font-size:14px;">${a.title}</div>
                                <div style="font-size:12px; color:${themeColor}; margin-bottom:5px; font-weight:600;">${a.year}</div>
                                <div class="item-desc">${formatDesc(a.description)}</div>
                            </div>
                        `).join('')}
                    </div>` : ''}

                    <div style="margin-bottom:30px">
                        <h3 style="border-bottom-color:${themeColor}">Education</h3>
                         ${resumeData.education.map(e => `
                            <div style="margin-bottom:15px;">
                                <div class="item-title" style="font-size:14px;">${e.degree}</div>
                                <div class="item-subtitle">${e.institution}</div>
                                <div style="font-size:12px; color:${themeColor}; margin-bottom:5px; font-weight:600;">${e.year}</div>
                                <div class="item-desc" style="color:#666">${e.details}</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    ${resumeData.declaration ? `
                    <div style="margin-top:40px; border-top:1px solid #eee; padding-top:10px;">
                         <h3 style="border:none; margin-bottom:5px; font-size:13px;">Declaration</h3>
                        <p style="font-size:12px; font-style:italic; color:#555;">${resumeData.declaration}</p>
                    </div>` : ''}
                </div>
            `;
        }

        container.innerHTML = html;
    }
</script>

</body>
    </html>
